<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Assistente Intellih | Diagn√≥stico de Automa√ß√£o</title>
  <meta name="description" content="Converse com o assistente da Intellih e descubra o que automatizar no seu neg√≥cio.">
  <link rel="stylesheet" href="style.css">

  <!-- Meta Pixel - dupla configura√ß√£o -->
  <script>
    !(function(f,b,e,v,n,t,s){
      if(f.fbq)return;n=f.fbq=function(){n.callMethod?
      n.callMethod.apply(n,arguments):n.queue.push(arguments)};
      if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
      n.queue=[];t=b.createElement(e);t.async=!0;t.src=v;
      s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)
    })(window, document, 'script', 'https://connect.facebook.net/en_US/fbevents.js');

    fbq('init','3929736470503988');
    fbq('track','PageView');
    fbq('init','790540353803292');
    fbq('track','PageView');

    setTimeout(()=>{
      fbq('trackCustom','TimeOnPage10s');
      fbq('trackCustom','TimeOnPage10s',{},{
        eventID:'TimeOnPage10s',
        pixelId:'790540353803292'
      });
    },10000);
  </script>

  <noscript><img height="1" width="1" style="display:none"
    src="https://www.facebook.com/tr?id=3929736470503988&ev=PageView&noscript=1"
  /></noscript>
</head>

<body>
  <main class="chat-container">
    <header class="header">
      <div class="avatar" title="Agente Intellih"></div>
      <div class="title">
        <h1>Assistente Intellih <span class="status-dot"></span></h1>
        <p id="status-text">Online</p>
      </div>
      <button id="voice-toggle" class="voice-btn" title="Ativar ou desativar voz">üîä</button>
    </header>

    <div id="chat-box" class="chat-box"></div>

    <footer class="footer">
      Intellih Tecnologia ¬© 2025
    </footer>
  </main>

  <div class="intellih-badge">
    <a href="https://www.intellih.com.br" target="_blank" rel="noopener">
      <img src="assets/logo-intellih.png" alt="Intellih Logo">
      <span>Criado por <strong>Intellih</strong></span>
    </a>
  </div>

  <script>
    window.__INTELLIH__ = {
      WEBAPP_URL: "https://script.google.com/macros/s/AKfycbweW56yedcnradB33gIRs6Sw1CfmvbLdbnAlogXfHHGYGnjs4CXZS2AEMpvrGkOsyB4/exec",
      EBOOK_URL: "https://fluxo.intellih.com.br/e-books/ebook-automacao-inteligente.pdf",
      SECRET_KEY: "INTELLIH2025"
    };
  </script>

  <script>
  const chatBox = document.getElementById("chat-box");
  const statusDot = document.querySelector(".status-dot");
  const statusText = document.getElementById("status-text");
  const voiceBtn = document.getElementById("voice-toggle");
  let voiceEnabled = false;

  // som de notifica√ß√£o
  const ping = new Audio("https://cdn.pixabay.com/download/audio/2022/03/15/audio_4f80e8ffdf.mp3?filename=notification-6990.mp3");

  const CFG = (window.__INTELLIH__ || {});
  const WEBAPP_URL = CFG.WEBAPP_URL || "";
  const EBOOK_URL  = CFG.EBOOK_URL  || "";
  const SECRET_KEY = CFG.SECRET_KEY || "INTELLIH2025";

  const PIXEL_SECOND = "790540353803292";
  const delay = (ms)=>new Promise(r=>setTimeout(r,ms));

  function dualTrack(e,t='track',p={}){fbq(t,e,p);fbq(t,e,p,{eventID:e,pixelId:PIXEL_SECOND});}
  function dualTrackCustom(e,p={}){fbq('trackCustom',e,p);fbq('trackCustom',e,p,{eventID:e,pixelId:PIXEL_SECOND});}

  // üîä Fala do assistente
  function speak(text) {
    if (!voiceEnabled || !window.speechSynthesis) return;
    const utter = new SpeechSynthesisUtterance(text.replace(/<[^>]+>/g, ''));
    utter.lang = "pt-BR";
    utter.pitch = 1;
    utter.rate = 0.9; // fala mais suave
    utter.volume = 1;
    const voices = speechSynthesis.getVoices();
    const brVoice = voices.find(v => v.lang === "pt-BR" && v.name.toLowerCase().includes("female"));
    if (brVoice) utter.voice = brVoice;
    speechSynthesis.cancel();
    speechSynthesis.speak(utter);
  }

  // Bot√£o de voz
  voiceBtn.addEventListener("click", () => {
    voiceEnabled = !voiceEnabled;
    voiceBtn.textContent = voiceEnabled ? "üîá" : "üîä";
    if (voiceEnabled) speak("Voz do assistente ativada.");
  });

  // üîπ Efeito de digita√ß√£o (mais lento)
  async function typingEffect(text, from='bot', speed=45) {
    const wrap = document.createElement('div');
    wrap.className = 'message ' + (from==='user' ? 'user' : 'bot');
    const bubble = document.createElement('div');
    bubble.className = 'bubble typing';
    wrap.appendChild(bubble);
    chatBox.appendChild(wrap);
    chatBox.scrollTop = chatBox.scrollHeight;

    await delay(600 + Math.random()*600); // pausa natural
    bubble.classList.remove('typing');

    ping.play().catch(()=>{}); // toca som
    for (let i = 0; i < text.length; i++) {
      bubble.innerHTML = text.slice(0, i + 1);
      chatBox.scrollTop = chatBox.scrollHeight;
      await delay(speed);
    }

    if (from === 'bot') speak(text);
  }

  function buttons(arr){
    const div=document.createElement('div');
    div.className='buttons';
    arr.forEach(({label,onClick})=>{
      const b=document.createElement('button');
      b.textContent=label;
      b.onclick=()=>{
        dualTrackCustom('BotInteraction');
        div.remove();
        onClick();
      };
      div.appendChild(b);
    });
    chatBox.appendChild(div);
    chatBox.scrollTop=chatBox.scrollHeight;
  }

  function inputField(type='text',placeholder='Digite aqui...'){
    const inp=document.createElement('input');
    inp.type=type; inp.placeholder=placeholder;
    inp.addEventListener('focus',()=>dualTrackCustom('BotInteraction'));
    chatBox.appendChild(inp);
    chatBox.scrollTop=chatBox.scrollHeight;
    return inp;
  }

  async function start(){
    await typingEffect('Ol√°! üëã Seja bem-vindo(a) √† Intellih.');
    await typingEffect('Esta conversa √© uma demonstra√ß√£o real do que automa√ß√µes inteligentes e agentes de IA podem fazer pelo seu neg√≥cio.');
    await typingEffect('Quer descobrir, na pr√°tica, o que automatizar na sua empresa com IA e receber um mini e-book sobre automa√ß√£o?');
    buttons([
      {label:'Sim, quero!', onClick:()=>{dualTrackCustom('LeadIntent'); fasePerfil();}},
      {label:'Quero ver exemplos primeiro', onClick:faseExemplos}
    ]);
  }

  async function fasePerfil(){
    await typingEffect('Perfeito! Me diga com qual perfil voc√™ mais se identifica:');
    buttons([
      {label:'Empreendedor(a)', onClick:()=>faseNome('Empreendedor')},
      {label:'Aut√¥nomo(a)', onClick:()=>faseNome('Aut√¥nomo')},
      {label:'Curioso(a) sobre IA', onClick:()=>faseNome('Curioso')}
    ]);
  }

  async function faseExemplos(){
    await typingEffect('Veja alguns exemplos de automa√ß√µes que implementamos:');
    await typingEffect('‚Ä¢ Capta√ß√£o autom√°tica de leads<br>‚Ä¢ Atendimento inteligente no WhatsApp<br>‚Ä¢ Relat√≥rios e an√°lises com IA<br>‚Ä¢ Agendamentos autom√°ticos');
    buttons([{label:'Quero meu diagn√≥stico gratuito', onClick:()=>faseNome('Interessado')}]);
  }

  async function faseNome(tipo){
    await typingEffect('Antes de prosseguirmos, me diga seu nome:');
    const inp=inputField('text','Digite seu nome completo');
    buttons([{label:'Pr√≥ximo',onClick:()=>faseEmail(tipo,(inp.value||'').trim())}]);
  }

  async function faseEmail(tipo,nome){
    if(!nome){await typingEffect('Por favor, digite seu nome antes de continuar.');return;}
    await typingEffect(`Prazer, ${nome}! Agora me informe seu e-mail:`);
    const inp=inputField('email','voce@empresa.com');
    buttons([{label:'Pr√≥ximo',onClick:()=>faseEbook(tipo,nome,(inp.value||'').trim())}]);
  }

  async function faseEbook(tipo,nome,email){
    if(!/^[^@\s]+@[^@\s]+\.[^@\s]+$/.test(email)){
      await typingEffect('E-mail inv√°lido. Tente novamente.');
      return;
    }
    await typingEffect('Deseja receber tamb√©m o e-book "Automa√ß√£o Inteligente"?');
    buttons([
      {label:'Sim, enviar e-book',onClick:()=>enviar(nome,email,tipo,true)},
      {label:'Agora n√£o',onClick:()=>enviar(nome,email,tipo,false)}
    ]);
  }

  async function enviar(nome,email,tipo,ebookOptIn){
    dualTrack('Lead');
    await typingEffect('Processando suas informa√ß√µes...');
    const params=new URLSearchParams(window.location.search);
    const origem={
      utm_source:params.get("utm_source")||"direto",
      utm_medium:params.get("utm_medium")||"nao_definido",
      utm_campaign:params.get("utm_campaign")||"nao_definido"
    };

    try{
      const res=await fetch(WEBAPP_URL,{
        method:'POST',
        body:JSON.stringify({nome,email,tipo,ebookOptIn,token:SECRET_KEY,...origem})
      });
      const text=await res.text();
      if(res.ok && text.includes('OK')){
        dualTrack('CompleteRegistration');
        await typingEffect(`Perfeito, ${nome}!`);
        if(ebookOptIn && EBOOK_URL){
          dualTrackCustom('DownloadEbook');
          await typingEffect('Voc√™ receber√° seu diagn√≥stico gratuito em at√© 24 horas e, tamb√©m, j√° enviei um e-mail com o link do e-book. Se preferir, pode acessar por aqui:');
          await typingEffect(`<a href="${EBOOK_URL}" target="_blank" rel="noopener">Baixar e-book Automa√ß√£o Inteligente</a>`);
        } else {
          await typingEffect('Tudo certo! Voc√™ receber√° seu diagn√≥stico gratuito em at√© 24 horas.');
        }
      } else {
        await typingEffect('Ocorreu um erro ao enviar seus dados. Tente novamente mais tarde.');
      }
    } catch(err){
      console.error(err);
      await typingEffect('Falha de comunica√ß√£o com o servidor.');
    }
  }

  start();
  </script>

  <style>
  .typing {
    position: relative;
    color: transparent !important;
    min-width: 60px;
    height: 18px;
    background: linear-gradient(90deg, #ddd 25%, #eee 37%, #ddd 63%);
    background-size: 400% 100%;
    animation: pulse 1.2s ease-in-out infinite;
    border-radius: 10px;
  }
  @keyframes pulse {
    0% { background-position: 100% 0; }
    100% { background-position: 0 0; }
  }
  .voice-btn {
    background: transparent;
    border: none;
    font-size: 1.3rem;
    cursor: pointer;
    margin-left: auto;
  }
  .voice-btn:hover {
    transform: scale(1.1);
  }
  </style>
</body>
</html>
